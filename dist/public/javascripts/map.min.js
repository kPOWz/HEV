function initialize(){var e=new google.maps.LatLng(41.5895,-93.612),r=[{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#cccccc"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{hue:0},{saturation:100},{lightness:100}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#D1AB38"},{lightness:-35}]}],t={zoom:15,maxZoom:19,minZoom:15,center:e,backgroundColor:"#FFFFFF",styles:r,mapTypeControl:!1},a=document.getElementById("map-canvas");map=new google.maps.Map(a,t),requestCategorizedStore={location:e,radius:250,types:storeTypes},requestUncategorizedStore={location:e,radius:200,types:["store"]},requestDining={location:e,radius:300,types:["restaurant","cafe"]},requestDrink={location:e,radius:450,types:["cafe","bar","night_club","lounge"]},NEIGHBORHOOD.addRequest(0,requestCategorizedStore,storeCallback),NEIGHBORHOOD.addRequest(0,requestUncategorizedStore,storeCallback),NEIGHBORHOOD.addRequest(1,requestDrink,drinkCallback),NEIGHBORHOOD.addRequest(2,requestDining,diningCallback),kmlLayer=new google.maps.FusionTablesLayer({query:{select:"geometry",from:"1400IQGlzH5dGWJsruolfKlOXFXjUkJvxUXPD8QCW",where:"'NHNAME' = 'Historic East Village'"},styles:[{polygonOptions:{fillOpacity:.1,strokeColor:"#CC3333"}}]}),NEIGHBORHOOD.draw(kmlLayer,map),placesService=new google.maps.places.PlacesService(map),infowindow=new google.maps.InfoWindow,google.maps.event.addListener(map,"zoom_changed",setNeighborhood)}function makeMarker(e,r){var t={path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:e,fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWeight:1};return new google.maps.Marker({icon:t,map:map,position:r})}function storeCallback(e,r,t){callback(e,r,t,storeMarkers)}function diningCallback(e,r,t){callback(e,r,t,diningMarkers)}function drinkCallback(e,r,t){callback(e,r,t,drinkMarkers)}function serviceCallback(e,r,t){callback(e,r,t,serviceMarkers)}function callback(e,r,t,a){if(r==google.maps.places.PlacesServiceStatus.OK)if(createMarkers(e,a),resultsCount+=e.length,t.hasNextPage)t.nextPage();else{console.log(resultsCount);var o=document.getElementById("select-cat");o&&NEIGHBORHOOD.addLayer(o.value,a),createInfoWindows(a)}}function createMarkers(e,r){for(var t=0;t<e.length;t++){var a=e[t],o=createMarker(a);if(o&&o.getPosition()){var n=getMarkerUniqueId(o.getPosition().lat(),o.getPosition().lng());r.push({markerId:n,marker:o,reference:a.reference})}}}function createMarker(e){var r,t=e.geometry.location,a=document.getElementById("select-cat");if(a&&(a=a.options[a.selectedIndex].innerHTML.toLowerCase()),"shop"==a){var o=e.types.some(function(e){return storeTypes.indexOf(e)>-1}),n=uncategorizedStoreInclude.indexOf(e.name)>-1;(o||n)&&(r=makeMarker("#40AD48",t,e))}return"dine"==a&&(r=makeMarker("#EC008B",t,e)),"drink"==a&&(r=makeMarker("#00ADEF",t,e)),r}function createInfoWindows(e){for(var r=0;r<e.length;r++)createInfoWindow(e[r].marker,e[r].reference)}function createInfoWindow(e){google.maps.event.addListener(e,"click",function(){var r=document.getElementById("select-cat");r&&(r=r.options[r.selectedIndex].innerHTML.toLowerCase());var t=getMarkerUniqueId(e.getPosition().lat(),e.getPosition().lng());if(storeMarkers.length>0&&"shop"==r)var a=storeMarkers.filter(function(e){return e.markerId==t});if(diningMarkers.length>0&&"dine"==r)var a=diningMarkers.filter(function(e){return e.markerId==t});if(drinkMarkers.length>0&&"drink"==r)var a=drinkMarkers.filter(function(e){return e.markerId==t});var o={reference:a[0].reference};placesService.getDetails(o,function(e,r){var t='<a href="#" id="place-detail-pane-close" class="button">X</a>';if(r==google.maps.places.PlacesServiceStatus.OK?t=t+'<div class="h-card"><p class="p-name"><strong>'+e.name+'</strong></p><div class="p-tel tel"><dt>Phone: </dt><dd><a class="value phone" href="tel:'+e.formatted_phone_number+'"> '+e.formatted_phone_number+'</a></dd></div><p class="p-adr h-adr"><div class="p-street-address street-address" >'+e.address_components[0].short_name+" "+e.address_components[1].short_name+"</div></p></div>":(console.warn("not ok place with reference"+a[0].reference),t+='<p class="p-name"><strong>place detail could not be retrieved </strong></p>'),Modernizr.csstransitions&&Modernizr.csstransforms){var o=document.getElementById("place-detail-pane");o&&(o.innerHTML=t)}else infowindow.setContent(t),infowindow.open(map,a[0].marker)});var n=document.getElementById("trigger-detail-pane");n.click||addClickEvent(n),n.click()})}function changeCategory(e){e.className=e.options[e.selectedIndex].innerHTML.toLowerCase(),infowindow.close(),NEIGHBORHOOD.switchLayer(e.value,map,placesService)}function addClickEvent(e){"undefined"==typeof e||e.click||(e.click=function(){var e=this.ownerDocument.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,this.ownerDocument.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(e)})}function showMarkers(e){e.forEach(function(e){e.marker.setVisible(!0)})}function setNeighborhood(){kmlLayer.setMap(map.getZoom()<=15?map:null)}var map,placesService,neighborhoodPolygon,resultList,infowindow,kmlLayer,requestCategorizedStore,requestUncategorizedStore,requestDining,requestDrink,resultsCount=0,uncategorizedStoreInclude=["Bargain Basket","Liberty Gifts","Hammer Pharmacy","Ephemera","Found Things","Jett and Monkey's Dog Shoppe","Subsect Skateboard Shop","Vanity & Glamour Cosmetics / VGCosmetic Makeup Artists","Porch Light","Green Goods For The Home","Metroretro"],storeTypes=["furniture_store","clothing_store","bicycle_store","home_goods_store","jewelry_store","pet_store","shoe_store","grocery_or_supermarket","art_gallery","book_store","thrift_store"],storeMarkers=[],diningMarkers=[],drinkMarkers=[],serviceMarkers=[],getMarkerUniqueId=function(e,r){return e+"_"+r};google.maps.event.addDomListener(window,"load",initialize);