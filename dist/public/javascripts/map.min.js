function initialize(){var e=new google.maps.LatLng(41.5895,-93.612),t=[{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#cccccc"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{hue:0},{saturation:100},{lightness:100}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#D1AB38"},{lightness:-35}]}],a={zoom:15,maxZoom:19,minZoom:15,center:e,backgroundColor:"#FFFFFF",styles:t,mapTypeControl:!1},o=document.getElementById("map-canvas");map=new google.maps.Map(o,a);var r={location:e,radius:250,types:storeTypes},n={location:e,radius:200,types:["store"]},s={location:e,radius:300,types:["restaurant","cafe"]},i={location:e,radius:450,types:["cafe","bar","night_club","lounge"]};NEIGHBORHOOD.addRequest(0,r,callback),NEIGHBORHOOD.addRequest(0,n,callback),NEIGHBORHOOD.addRequest(1,i,callback),NEIGHBORHOOD.addRequest(2,s,callback),PLACE.addCustomCategory(0,storeTypes,uncategorizedStoreInclude),kmlLayer=new google.maps.FusionTablesLayer({query:{select:"geometry",from:"1400IQGlzH5dGWJsruolfKlOXFXjUkJvxUXPD8QCW",where:"'NHNAME' = 'Historic East Village'"},styles:[{polygonOptions:{fillOpacity:.1,strokeColor:"#CC3333"}}]}),NEIGHBORHOOD.draw(kmlLayer,map),placesService=new google.maps.places.PlacesService(map),infowindow=new google.maps.InfoWindow,google.maps.event.addListener(map,"zoom_changed",setNeighborhood)}function callback(e,t,a){var o=0;if(t==google.maps.places.PlacesServiceStatus.OK){var r=document.getElementById("select-cat");if(r)var n=r.value;createPlaces(e,places,n),o+=e.length,a.hasNextPage?a.nextPage():(console.log(o),r&&NEIGHBORHOOD.addLayer(n,places),createInfoWindows(places))}}function createPlaces(e,t,a){for(var o=0;o<e.length;o++){var r=e[o],n=PLACE.createMarker(map,r,a);if(n&&n.getPosition()){var s=PLACE.getMarkerUniqueId(n.getPosition().lat(),n.getPosition().lng());t.push({markerId:s,marker:n,reference:r.reference})}}}function createInfoWindows(e){for(var t=0;t<e.length;t++)INFOWINDOW.createInfoWindow(e[t],placesService,infowindow,map)}function changeCategory(e){places=[],e.className=e.options[e.selectedIndex].innerHTML.toLowerCase(),infowindow.close(),NEIGHBORHOOD.switchLayer(e.value,map,placesService)}function setNeighborhood(){map.getZoom()<=15?kmlLayer.setMap(map):kmlLayer.setMap(null)}var INFOWINDOW=function(){var e=function(e){"undefined"==typeof e||e.click||(e.click=function(){var e=this.ownerDocument.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,this.ownerDocument.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(e)})},t=function(e,t){var a={reference:e};placesService.getDetails(a,function(e,a){var o='<a href="#" id="place-detail-pane-close" class="button">X</a>';if(a==google.maps.places.PlacesServiceStatus.OK?o=o+'<div class="h-card"><p class="p-name"><strong>'+e.name+'</strong></p><div class="p-tel tel"><dt>Phone: </dt><dd><a class="value phone" href="tel:'+e.formatted_phone_number+'"> '+e.formatted_phone_number+'</a></dd></div><p class="p-adr h-adr"><div class="p-street-address street-address" >'+e.address_components[0].short_name+" "+e.address_components[1].short_name+"</div></p></div>":(console.warn("not ok place with reference"+markerContainer.reference),o+='<p class="p-name"><strong>place detail could not be retrieved </strong></p>'),Modernizr.csstransitions&&Modernizr.csstransforms){var r=document.getElementById("place-detail-pane");r&&(r.innerHTML=o)}else t.setContent(o),t.open(map,markerContainer.marker)})};return{createInfoWindow:function(a,o,r){google.maps.event.addListener(a.marker,"click",function(){t(a.reference,r);var o=document.getElementById("trigger-detail-pane");o.click||e(o),o.click()})}}}(),map,placesService,resultList,infowindow,kmlLayer,places=[],uncategorizedStoreInclude=["Bargain Basket","Liberty Gifts","Hammer Pharmacy","Ephemera","Found Things","Jett and Monkey's Dog Shoppe","Subsect Skateboard Shop","Vanity & Glamour Cosmetics / VGCosmetic Makeup Artists","Porch Light","Green Goods For The Home","Metroretro"],storeTypes=["furniture_store","clothing_store","bicycle_store","home_goods_store","jewelry_store","pet_store","shoe_store","grocery_or_supermarket","art_gallery","book_store","thrift_store"];google.maps.event.addDomListener(window,"load",initialize);var NEIGHBORHOOD=function(){var e=[],t={},a=15,o=function(t){if(!(e.length<1)){var a;e[t]&&(a=e[t],delete e[t]),e.forEach(function(e){e.forEach(function(e){e.marker.setVisible(!1)})}),e[t]||(e[t]=a)}},r=function(e){e.forEach(function(e){e.marker.setVisible(!0)})},n=function(e,t,a){a.nearbySearch(e,t)},s=function(a,s){o(a);var i=document.getElementById("place-detail-pane-close");if(i&&i.click(),void 0!=e[a])r(e[a]);else for(var c=0;c<t[a].length;c++)n(t[a][c].request,t[a][c].callback,s)};return{switchLayer:function(e,t,a){s(e,a),t.getZoom()<17&&t.setZoom(17)},addRequest:function(e,a,o){void 0==t[e]?t[e]=[{request:a,callback:o}]:t[e].push({request:a,callback:o})},addLayer:function(t,a){void 0==e[t]&&(e[t]=a)},drawLayer:function(a,o){void 0==e[a]?n(t[a].request,t[a].callback,o):r(e[a])},draw:function(e,t){t.getZoom()<=a?e.setMap(t):kmlLayer.setMap(null)}}}(),PLACE=function(){var e=["#40AD48","#EC008B","#00ADEF"],t={},a=function(e,t){var a={path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:e,fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWeight:1};return new google.maps.Marker({icon:a,map:map,position:t})};return{createMarker:function(o,r,n){var s,i,c=r.geometry.location;return t[n]&&(s=r.types.some(function(e){return t[n].categories.indexOf(e)>-1}),i=t[n].exceptions.indexOf(r.name)>-1),void 0==t[n]||s||i?a(e[n],c,r):void 0},getMarkerUniqueId:function(e,t){return e+"_"+t},addCustomCategory:function(e,a,o){t[e]={categories:a,exceptions:o}}}}();