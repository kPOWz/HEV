function initialize(){var e=new google.maps.LatLng(41.5895,-93.612),r=[{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#cccccc"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{hue:0},{saturation:100},{lightness:100}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],n={zoom:17,maxZoom:19,minZoom:15,center:e,backgroundColor:"#FFFFFF",styles:r,mapTypeControl:!1},a=document.getElementById("map-canvas");map=new google.maps.Map(a,n);var o=[new google.maps.LatLng(41.5905,-93.6176),new google.maps.LatLng(41.5945,-93.5983),new google.maps.LatLng(41.5897,-93.5968),new google.maps.LatLng(41.5898,-93.598),new google.maps.LatLng(41.5862,-93.6161),new google.maps.LatLng(41.5876,-93.6166),new google.maps.LatLng(41.5885,-93.6169),new google.maps.LatLng(41.5895,-93.6172),new google.maps.LatLng(41.59,-93.6174),new google.maps.LatLng(41.5905,-93.6176)],t={path:"M 0,-1 0,1",strokeOpacity:.5,scale:4};hevBoundaries=new google.maps.Polyline({path:o,strokeOpacity:0,icons:[{icon:t,offset:"0",repeat:"20px"}],map:map}),requestCategorizedStore={location:e,radius:250,types:storeTypes},requestUncategorizedStore={location:e,radius:200,types:["store"]},requestDining={location:e,radius:300,types:["restaurant","cafe"]},requestDrink={location:e,radius:450,types:["cafe","bar","night_club","lounge"]},placesService=new google.maps.places.PlacesService(map),placesService.nearbySearch(requestCategorizedStore,storeCallback),placesService.nearbySearch(requestUncategorizedStore,storeCallback);var s=document.querySelector("#templateSelectCategory"),i=document.importNode(s.content,!0),c=document.createElement("div");c.appendChild(i),c.index=1,c.id="select-container",map.controls[google.maps.ControlPosition.TOP_RIGHT].push(c),infowindow=new google.maps.InfoWindow}function makeMarker(e,r){var n={path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:e,fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWeight:1};return new google.maps.Marker({icon:n,map:map,position:r})}function storeCallback(e,r,n){callback(e,r,n,storeMarkers)}function diningCallback(e,r,n){callback(e,r,n,diningMarkers)}function drinkCallback(e,r,n){callback(e,r,n,drinkMarkers)}function serviceCallback(e,r,n){callback(e,r,n,serviceMarkers)}function callback(e,r,n,a){r==google.maps.places.PlacesServiceStatus.OK&&(createMarkers(e,a),resultsCount+=e.length,n.hasNextPage?n.nextPage():(console.log(resultsCount),createInfoWindows(a)))}function createMarkers(e,r){for(var n=0;n<e.length;n++){var a=e[n],o=createMarker(a);o&&r.push({markerId:o.__gm_id,marker:o,reference:a.reference})}}function createMarker(e){var r,n=e.geometry.location;console.log(e.name+":	 "+e.types);var a=document.getElementById("select-cat").value;if("shop"==a){var o=e.types.some(function(e){return storeTypes.indexOf(e)>-1}),t=uncategorizedStoreInclude.indexOf(e.name)>-1;(o||t)&&(r=makeMarker("#40AD48",n,e))}return"dine"==a&&(r=makeMarker("#EC008B",n,e)),"drink"==a&&(r=makeMarker("#00ADEF",n,e)),r}function createInfoWindows(e){for(var r=0;r<e.length;r++)createInfoWindow(e[r].marker,e[r].reference)}function createInfoWindow(e,r){console.log("reference: "+r),google.maps.event.addListener(e,"click",function(){var r=document.getElementById("select-cat").value;if(storeMarkers.length>0&&"shop"==r)var n=storeMarkers.filter(function(r){return r.markerId==e.__gm_id});if(diningMarkers.length>0&&"dine"==r)var n=diningMarkers.filter(function(r){return r.markerId==e.__gm_id});if(drinkMarkers.length>0&&"drink"==r)var n=drinkMarkers.filter(function(r){return r.markerId==e.__gm_id});var a={reference:n[0].reference};placesService.getDetails(a,function(e,r){if(r==google.maps.places.PlacesServiceStatus.OK){var a=document.querySelector("#templateInfoWindow");a.content.querySelector(".p-name").innerHTML="<strong>"+e.name+"</strong>";var o=a.content.querySelector(".phone");o.href="tel:"+e.formatted_phone_number,o.innerHTML=e.formatted_phone_number,a.content.querySelector(".p-street-address").innerHTML=e.address_components[0].short_name+" "+e.address_components[1].short_name;var t=document.importNode(a.content,!0),s=document.createElement("div");s.appendChild(t),console.log(s.innerHTML),infowindow.setContent(s.innerHTML),infowindow.open(map,n[0].marker)}else console.warn("not ok place with reference"+n[0].reference)})})}function changeCategory(e){e.className=e.value,hideMarkers(e.value),infowindow.close(),"shop"==e.value&&(storeMarkers.length>0?showMarkers(storeMarkers):placesService.nearbySearch(requestStore,storeCallback)),"dine"==e.value&&(diningMarkers.length>0?showMarkers(diningMarkers):placesService.nearbySearch(requestDining,diningCallback)),"drink"==e.value&&(drinkMarkers.length>0?showMarkers(drinkMarkers):placesService.nearbySearch(requestDrink,drinkCallback))}function hideMarkers(e){"shop"==e&&(diningMarkers.forEach(function(e){e.marker.setVisible(!1)}),drinkMarkers.forEach(function(e){e.marker.setVisible(!1)})),"dine"==e&&(storeMarkers.forEach(function(e){e.marker.setVisible(!1)}),drinkMarkers.forEach(function(e){e.marker.setVisible(!1)})),"drink"==e&&(storeMarkers.forEach(function(e){e.marker.setVisible(!1)}),diningMarkers.forEach(function(e){e.marker.setVisible(!1)}))}function showMarkers(e){e.forEach(function(e){e.marker.setVisible(!0)})}var map,placesService,resultList,infowindow,requestStore,requestDining,requestDrink,resultsCount=0,uncategorizedStoreInclude=["Bargain Basket","Liberty Gifts","Hammer Pharmacy","Ephemera","Found Things","Jett and Monkey's Dog Shoppe","Subsect Skateboard Shop","Vanity & Glamour Cosmetics / VGCosmetic Makeup Artists","Porch Light","Green Goods For The Home","Metroretro"],storeTypes=["furniture_store","clothing_store","bicycle_store","home_goods_store","jewelry_store","pet_store","shoe_store","grocery_or_supermarket","art_gallery","book_store"],storeMarkers=[],diningMarkers=[],drinkMarkers=[],serviceMarkers=[];google.maps.event.addDomListener(window,"load",initialize);